<!DOCTYPE html>
<html>

  <head>
    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Dynaphopy : Phonon Analysis from Dynamical Data">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Dynaphopy</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h2 id="project_tagline">Advanced options</h2>

        </header>
    </div>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
    	<section id="main_content" class="inner">


<h3>Big data</h3>
<p>
In order to obtain well converged results in the calculation of anharmonic phonon properties, specially in phonon linewidths, 
usually it becomes necessary to use very long MD simulations. This requires long calculation times and imply to hadle very large 
files. Fortunatelly, in canonical ensemble the velocity time correlation decreases relativelly fast as the time advances. That means that
it becomes possible to join several independent MD trajectories to obtain a larger one with almost negligible added error. That allows to
calculate many independent MD simulations at the same time and join them later to obtain a larger MD trajectory and increase the accuracy of
the results.
<br>To support this task Dynaphopy can save the MD information into a hdf5 file to be read afterwards. Additionally I provide an independent
script called <strong>concath5</strong> which allows join several hdf5 files into one.
<br><em>Note: VASP code has to be compiled with advanced features in order to start MD from random velocities and generate different 
trajectories each run. Please, refere to VASP <a href=http://cms.mpi.univie.ac.at/vasp/vasp/Advanced_MD_techniques.html">documentation</a> 
for further information.</em></p>
<UL>
<LI><h5>Save data into hdf5 file </h5>
<p>Saving data into hdf5 file can be usefull in order to save space in the hard drive. Since only the necessary information for dynaphopy
is stored, this hdf5 file size can be around 5 times smaller than the original OUTCAR. Besides it allows to manipulate this information as
an intermediate step using concath5 or other third party software. To request to save MD trajectory into hdf5 file use 
<strong>-sv</strong> flag follower by the file name. 
<br>This option can be used alone  or together with other flags but, in any case, all time steps in OUTCAR file will be stored in the hdf5 file (<strong>-n</strong> 
flag has no effect in the number of time steps stored).</p>

<pre><code>$ ./dynaphopy input_file OUTCAR -sv filename.h5</code></pre>

<LI><h5>Load data into hdf5 file </h5>
<p> Once saved into a hdf5 file, MD data can be load to dynaphopy using <strong>-lv</strong> flag. Loading data from hdf5 is much faster
than using OUTCAR file, if several calculation using the same data have to be done, it is highly recomended to use this option.
<br><em>Notice that when loading data this way, OUTCAR file has to not be set.</em></p>

<pre><code>$ ./dynaphopy input_file -lv filename.h5</code></pre>

<LI><h5>Manipulating data</h5>
<p>
The structure of the hdf5 file is quite simple. With a minimum knowledge of programming it can be easly manipulated by third parties software.
In dynaphopy script directory a simple script for joining data is provided named <strong>concath5</strong>. It can be used as example 
for more complex ones. To use this script just call it followed by the name of all the hdf5 files to be joined and the last one 
the name of the new hdf5 file that will contain all the joined data. 
</p>
<pre><code>$ ./concath5 source1.h5 source2.h5 source3.h5 ··· joined.h5</code></pre>
<p>
By default <strong>concath5</strong> skips the first 20000 time steps of each source MD trajectory. This is done to ensure that the MD
is totally converged in each file. Using <strong>-f</strong> flag, is possible to define the number of time steps to be skipped.
</p>

<pre><code>$ ./concath5 -f 30000 source1.h5 source2.h5 ··· joined.h5</code></pre>
</UL>

<h3>MEM coeficient analysis</h3>
<p>
The correct setting of the number of coefficents in MEM algorithm to calculate the power spectrum is one of the crucial point to take in account.
Depending on the number of coefficents the peak width of the peaks may significantly change, which directly affects the phonon linewidths results.
<br>From my experience, if the MD simulations are long enough, as the number of coefficents increase the peak width become to stabilize while keeping the peaks shape smooth. Is to be expected than this stabilized width is more reliable even if the peaks become a little more uglyer.
<br>In order to check the evolution of the power spectra peaks width with the number of coefficents dynaphopy provides option <strong>-csa</strong>
which performs a scan for all peaks anf fits each one to Lorentzian function to extract width information.
All this information is plotted in 3 matplotlib windows for each phonon. 
</p>
<pre><code>$ ./dynaphopy input_file OUTCAR -csa</code></pre>

<img src="images/coef_ana_2.png" alt="Interactive" style="width:605px">
<img src="images/coef_ana_1.png" alt="Interactive" style="width:605px">
<img src="images/coef_ana_3.png" alt="Interactive" style="width:605px">

<p>Additionally, it shows the optimum number of coeficients that has the best
fit with a Lorentzian function and estimates the peak width value taking a average for all coefficents ponderated by the inverse of fit error.</p>

<pre><code>Peak # 5------------------------------------Estimated width(FWHM): 0.579539438413 THzPosition: 3.84799537133 THzOptimum coefficients num: 455.0Fitting Error(RMS): 0.257002329288</pre></code>

<h3>External power spectra analysis</h3>
<p>
The calculation of the power spectra, specially using Fourier transform method, can take a lot of time (maybe few days). For this reason the
calculation of these spectra may be done in a cluster computer in which may have no acces through graphical interface. This makes the fitting
analysis difficult since there is no way to evaluate visually if the fitting has been done properlly. Besides, the power spectrum obtained may
be noisy and a post processing may be needed.
<br>In dynaphopy package,  fitdata script is included in scripts folder to extract the anharmonic information from a power spectrum file obtained
with Dynaphopy throught <strong>-sw</strong> or <strong>-sp</strong> options. This allows to first calculate the power spectrum using DYnaphopy
in a cluster computer and latter extract the information in a local machine.
Additionally this script allows to perform a smoothing of the spectrum using the LOWESS method before fitting it with a Lorentzian function.
<br>During the execution it shows the smoothing result and the fitting result for each spectrum present in the spectrum file allowing to test
different smoothing parameters to obtain the best results.
</p>
<UL>
<LI><h5>Simple execution</h5>
<p> By default the script takes all the spectra present in the file and fits them to lorentzian function (equivalent to Dynaphopy Peak analysis).
</p>
<pre><code>$ fitdata file</code></pre>
<img src="images/fitting.png" alt="Interactive" style="width:605px">
<LI><h5>Smoothing spectra using LOWESS method</h5>
<p>LOWESS method works very well removing the noise in very noisy spectra. This allows to obtain much better results in the fit and in many cases
it becomes indispensable in order to get a meaningful fit. In this part, the visual anlysisi becomes necessary to compare the original noisy spectrum and the smoothed one to make sure that the essetial peak shape is kept. To request the smooth methos use <strong>-sm</strong> flag.
</p>
<pre><code>$ fitdata -sm file</code></pre>
<img src="images/smooth.png" alt="Interactive" style="width:605px">
<img src="images/fit_smooth.png" alt="Interactive" style="width:605px">
<LI><h5>Changing smoothing parameters</h5>
<p> In case that the smoothing process is not succesfull, the LOWESS method can be ajusted via two parameters: <strong>-f</strong> (Default: 0.2) and <strong>-iter</strong> (Default: 1 [always integer]). Increasing their values will make the strectra smoother but will differ more from the original spectrum. 
</p>
<pre><code>$ fitdata -sm -f 0.4 -iter 2 file</code></pre>
<LI><h5>Combining spectra</h5>
<p> In high symmetry points in the reciprocal space (wave vector), it may happen that two or more phonon are degenerated. In that case the projection into this wave vector and consequantlly, the power spectra should present the same properties (Width and position). In order to
increase the precision these equivalent spectra can be conbined into one reducing the random error. This can be done using <strong>-bi</strong> flag. Following this flag it must be introduced a string containing the number of the spectra to be combined separated by spaces (equivalent spectra) and the non equivalent spectra separated by comma.
the non e
</p>
<pre><code>$ fitdata -bi "1 2, 3 4, 5 6"</code></pre>




</UL>



    </section>
    </div>
    
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Dynaphopy maintained by <a href="https://github.com/abelcarreras">abelcarreras</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
    
  </body>
</html>